{% extends 'base.html' %}

{% block title %}Verify Certificate{% endblock %}

{% block content %}
<div class="container">
    <div class="page-header">
        <h1>Verify Certificate</h1>
        <a href="{% url 'dashboard' %}" class="btn btn-outline">Back to Dashboard</a>
    </div>

    <div class="form-card verify-card">
        <div class="verify-info">
            <h3>&#128270; How Verification Works:</h3>
            <ol>
                <li>Upload the certificate submitted by the student</li>
                <li>AI extracts text from the document (OCR)</li>
                <li>SHA-256 hash is generated from the file</li>
                <li>Hash is compared with blockchain records</li>
                <li>If match &#8594; <span class="text-success">VERIFIED</span></li>
                <li>If no match &#8594; <span class="text-danger">TAMPERED / INVALID</span></li>
            </ol>
        </div>

        <form method="post" enctype="multipart/form-data" class="verify-form">
            {% csrf_token %}

            <div class="upload-zone" id="upload-zone">
                <div class="upload-icon">&#128194;</div>
                <h3>Upload Certificate</h3>
                <p>Drag & drop or click to select a PDF or Image file</p>
                {{ form.certificate_file }}
                <div id="file-name" class="file-name-display"></div>
            </div>

            {% if form.certificate_file.errors %}
            <div class="field-errors">
                {% for error in form.certificate_file.errors %}
                <span class="error-text">{{ error }}</span>
                {% endfor %}
            </div>
            {% endif %}

            <div class="form-actions">
                <button type="submit" class="btn btn-primary btn-lg btn-block" id="verify-btn">
                    &#128270; Verify Certificate
                </button>
            </div>
        </form>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    // File name display
    const fileInput = document.querySelector('input[type="file"]');
    const fileNameDisplay = document.getElementById('file-name');

    fileInput.addEventListener('change', function() {
        if (this.files.length > 0) {
            fileNameDisplay.textContent = 'Selected: ' + this.files[0].name;
            fileNameDisplay.style.display = 'block';
        }
    });

    // Loading state
    document.querySelector('form').addEventListener('submit', function() {
        const btn = document.getElementById('verify-btn');
        btn.textContent = 'Verifying... Please wait';
        btn.disabled = true;
        btn.classList.add('btn-loading');
    });
</script>
{% endblock %}
